<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5 Data Modeling | Intermediate R</title>
  <meta name="description" content="5 Data Modeling | Intermediate R" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="5 Data Modeling | Intermediate R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5 Data Modeling | Intermediate R" />
  
  
  

<meta name="author" content="MAJ Dusty Turner" />


<meta name="date" content="2020-06-15" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="4-functional-programming.html"/>
<link rel="next" href="6-text-analysis.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />











<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(title);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href = "/">Tutorial Home</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Class Introduction</a><ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#expectations"><i class="fa fa-check"></i><b>1.1</b> Expectations</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#class-introductions"><i class="fa fa-check"></i><b>1.2</b> Class Introductions</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#instructors-introduction"><i class="fa fa-check"></i><b>1.3</b> Instructors Introduction</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#course-intent"><i class="fa fa-check"></i><b>1.4</b> Course Intent</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#get-course-documents"><i class="fa fa-check"></i><b>1.5</b> Get Course Documents</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#tidy-ecosystem"><i class="fa fa-check"></i><b>1.6</b> Tidy Ecosystem</a></li>
<li class="chapter" data-level="1.7" data-path="index.html"><a href="index.html#prerequisite-packages"><i class="fa fa-check"></i><b>1.7</b> Prerequisite Packages</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html"><i class="fa fa-check"></i><b>2</b> Data Manipulation</a><ul>
<li class="chapter" data-level="2.1" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#read-in-data"><i class="fa fa-check"></i><b>2.1</b> Read in Data</a></li>
<li class="chapter" data-level="2.2" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#analysis-with-dplyr"><i class="fa fa-check"></i><b>2.2</b> Analysis with <code>dplyr</code></a></li>
<li class="chapter" data-level="2.3" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#joins"><i class="fa fa-check"></i><b>2.3</b> Joins</a></li>
<li class="chapter" data-level="2.4" data-path="2-data-manipulation.html"><a href="2-data-manipulation.html#other-dplyr-tricks"><i class="fa fa-check"></i><b>2.4</b> Other dplyr Tricks</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-data-visualization.html"><a href="3-data-visualization.html"><i class="fa fa-check"></i><b>3</b> Data Visualization</a><ul>
<li class="chapter" data-level="3.1" data-path="3-data-visualization.html"><a href="3-data-visualization.html#bar-chart"><i class="fa fa-check"></i><b>3.1</b> Bar Chart</a></li>
<li class="chapter" data-level="" data-path="3-data-visualization.html"><a href="3-data-visualization.html#scatter-plot"><i class="fa fa-check"></i>Scatter Plot</a></li>
<li class="chapter" data-level="3.2" data-path="3-data-visualization.html"><a href="3-data-visualization.html#animation"><i class="fa fa-check"></i><b>3.2</b> Animation</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-functional-programming.html"><a href="4-functional-programming.html"><i class="fa fa-check"></i><b>4</b> Functional Programming</a><ul>
<li class="chapter" data-level="4.1" data-path="4-functional-programming.html"><a href="4-functional-programming.html#iteration"><i class="fa fa-check"></i><b>4.1</b> Iteration</a></li>
<li class="chapter" data-level="4.2" data-path="4-functional-programming.html"><a href="4-functional-programming.html#an-interesting-question"><i class="fa fa-check"></i><b>4.2</b> An Interesting Question</a></li>
<li class="chapter" data-level="4.3" data-path="4-functional-programming.html"><a href="4-functional-programming.html#a-more-general-question"><i class="fa fa-check"></i><b>4.3</b> A More General Question</a></li>
<li class="chapter" data-level="4.4" data-path="4-functional-programming.html"><a href="4-functional-programming.html#even-more-genarally"><i class="fa fa-check"></i><b>4.4</b> Even more Genarally</a></li>
<li class="chapter" data-level="4.5" data-path="4-functional-programming.html"><a href="4-functional-programming.html#even-more-genarally-1"><i class="fa fa-check"></i><b>4.5</b> Even more Genarally</a></li>
<li class="chapter" data-level="4.6" data-path="4-functional-programming.html"><a href="4-functional-programming.html#purrr"><i class="fa fa-check"></i><b>4.6</b> PURRR</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-data-modeling.html"><a href="5-data-modeling.html"><i class="fa fa-check"></i><b>5</b> Data Modeling</a><ul>
<li class="chapter" data-level="5.1" data-path="5-data-modeling.html"><a href="5-data-modeling.html#load-packages"><i class="fa fa-check"></i><b>5.1</b> Load Packages</a></li>
<li class="chapter" data-level="5.2" data-path="5-data-modeling.html"><a href="5-data-modeling.html#read-data"><i class="fa fa-check"></i><b>5.2</b> Read Data</a></li>
<li class="chapter" data-level="5.3" data-path="5-data-modeling.html"><a href="5-data-modeling.html#data-exploration"><i class="fa fa-check"></i><b>5.3</b> Data Exploration</a></li>
<li class="chapter" data-level="5.4" data-path="5-data-modeling.html"><a href="5-data-modeling.html#split-data-testtrain"><i class="fa fa-check"></i><b>5.4</b> Split Data test/train</a></li>
<li class="chapter" data-level="5.5" data-path="5-data-modeling.html"><a href="5-data-modeling.html#preprocess-data"><i class="fa fa-check"></i><b>5.5</b> Preprocess Data</a></li>
<li class="chapter" data-level="5.6" data-path="5-data-modeling.html"><a href="5-data-modeling.html#apply-preprocessing"><i class="fa fa-check"></i><b>5.6</b> Apply Preprocessing</a></li>
<li class="chapter" data-level="5.7" data-path="5-data-modeling.html"><a href="5-data-modeling.html#prepare-cross-validation"><i class="fa fa-check"></i><b>5.7</b> Prepare Cross Validation</a></li>
<li class="chapter" data-level="5.8" data-path="5-data-modeling.html"><a href="5-data-modeling.html#specify-models"><i class="fa fa-check"></i><b>5.8</b> Specify Models</a></li>
<li class="chapter" data-level="5.9" data-path="5-data-modeling.html"><a href="5-data-modeling.html#create-grid-of-parameters-to-validate-over"><i class="fa fa-check"></i><b>5.9</b> Create Grid of Parameters to Validate Over</a></li>
<li class="chapter" data-level="5.10" data-path="5-data-modeling.html"><a href="5-data-modeling.html#execute-cross-validation"><i class="fa fa-check"></i><b>5.10</b> Execute Cross Validation</a></li>
<li class="chapter" data-level="5.11" data-path="5-data-modeling.html"><a href="5-data-modeling.html#select-best-parameters"><i class="fa fa-check"></i><b>5.11</b> Select Best Parameters</a></li>
<li class="chapter" data-level="5.12" data-path="5-data-modeling.html"><a href="5-data-modeling.html#save-best-paramenters"><i class="fa fa-check"></i><b>5.12</b> Save Best Paramenters</a></li>
<li class="chapter" data-level="5.13" data-path="5-data-modeling.html"><a href="5-data-modeling.html#compare-models"><i class="fa fa-check"></i><b>5.13</b> Compare Models</a></li>
<li class="chapter" data-level="5.14" data-path="5-data-modeling.html"><a href="5-data-modeling.html#run-best-model-on-all-data"><i class="fa fa-check"></i><b>5.14</b> Run Best Model on All Data</a></li>
<li class="chapter" data-level="5.15" data-path="5-data-modeling.html"><a href="5-data-modeling.html#run-model-on-new-data"><i class="fa fa-check"></i><b>5.15</b> Run Model on New Data</a></li>
<li class="chapter" data-level="5.16" data-path="5-data-modeling.html"><a href="5-data-modeling.html#variable-importance"><i class="fa fa-check"></i><b>5.16</b> Variable Importance</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-text-analysis.html"><a href="6-text-analysis.html"><i class="fa fa-check"></i><b>6</b> Text Analysis</a><ul>
<li class="chapter" data-level="6.1" data-path="6-text-analysis.html"><a href="6-text-analysis.html#the-adventures-of-tom-sawyer"><i class="fa fa-check"></i><b>6.1</b> The Adventures of Tom Sawyer</a></li>
<li class="chapter" data-level="6.2" data-path="6-text-analysis.html"><a href="6-text-analysis.html#find-chapter-splits"><i class="fa fa-check"></i><b>6.2</b> Find Chapter Splits</a></li>
<li class="chapter" data-level="6.3" data-path="6-text-analysis.html"><a href="6-text-analysis.html#tokenize-the-book"><i class="fa fa-check"></i><b>6.3</b> Tokenize the Book</a></li>
<li class="chapter" data-level="6.4" data-path="6-text-analysis.html"><a href="6-text-analysis.html#remove-stop-words"><i class="fa fa-check"></i><b>6.4</b> Remove ‘stop words’</a></li>
<li class="chapter" data-level="6.5" data-path="6-text-analysis.html"><a href="6-text-analysis.html#join-sentiments"><i class="fa fa-check"></i><b>6.5</b> Join Sentiments</a></li>
<li class="chapter" data-level="6.6" data-path="6-text-analysis.html"><a href="6-text-analysis.html#descriptive-text-statistics"><i class="fa fa-check"></i><b>6.6</b> Descriptive Text Statistics</a></li>
<li class="chapter" data-level="6.7" data-path="6-text-analysis.html"><a href="6-text-analysis.html#visualizations"><i class="fa fa-check"></i><b>6.7</b> Visualizations</a></li>
<li class="chapter" data-level="6.8" data-path="6-text-analysis.html"><a href="6-text-analysis.html#n-gram-analysis"><i class="fa fa-check"></i><b>6.8</b> N-Gram Analysis</a></li>
<li class="chapter" data-level="6.9" data-path="6-text-analysis.html"><a href="6-text-analysis.html#term-frequency"><i class="fa fa-check"></i><b>6.9</b> Term Frequency</a></li>
<li class="chapter" data-level="6.10" data-path="6-text-analysis.html"><a href="6-text-analysis.html#topic-modeling"><i class="fa fa-check"></i><b>6.10</b> Topic Modeling</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Intermediate R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-modeling" class="section level1">
<h1><span class="header-section-number">5</span> Data Modeling</h1>
<div id="load-packages" class="section level2">
<h2><span class="header-section-number">5.1</span> Load Packages</h2>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb86-1" title="1"><span class="kw">library</span>(tidymodels)</a>
<a class="sourceLine" id="cb86-2" title="2"><span class="kw">library</span>(tune)</a>
<a class="sourceLine" id="cb86-3" title="3"><span class="kw">library</span>(dials)</a>
<a class="sourceLine" id="cb86-4" title="4"><span class="kw">library</span>(parsnip)</a>
<a class="sourceLine" id="cb86-5" title="5"><span class="kw">library</span>(rsample)</a>
<a class="sourceLine" id="cb86-6" title="6"><span class="kw">library</span>(recipes)</a>
<a class="sourceLine" id="cb86-7" title="7"><span class="kw">library</span>(textrecipes)</a>
<a class="sourceLine" id="cb86-8" title="8"><span class="kw">library</span>(yardstick)</a>
<a class="sourceLine" id="cb86-9" title="9"><span class="kw">library</span>(vip)</a>
<a class="sourceLine" id="cb86-10" title="10"><span class="kw">library</span>(gghighlight)</a>
<a class="sourceLine" id="cb86-11" title="11"><span class="kw">library</span>(patchwork)</a>
<a class="sourceLine" id="cb86-12" title="12"><span class="kw">library</span>(tidyverse)</a>
<a class="sourceLine" id="cb86-13" title="13"><span class="kw">library</span>(tidyquant)</a>
<a class="sourceLine" id="cb86-14" title="14"><span class="kw">library</span>(knitr)</a>
<a class="sourceLine" id="cb86-15" title="15"><span class="kw">library</span>(janitor)</a></code></pre></div>
</div>
<div id="read-data" class="section level2">
<h2><span class="header-section-number">5.2</span> Read Data</h2>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb87-1" title="1">data =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data_sources/Batting.csv&quot;</span>, <span class="dt">col_types =</span> <span class="kw">cols</span>(<span class="dt">SF =</span> <span class="kw">col_double</span>(), <span class="dt">GIDP =</span> <span class="kw">col_double</span>())) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb87-2" title="2"><span class="st">  </span><span class="kw">clean_names</span>()</a>
<a class="sourceLine" id="cb87-3" title="3"></a>
<a class="sourceLine" id="cb87-4" title="4">hofdata =<span class="st"> </span><span class="kw">read_csv</span>(<span class="st">&quot;data_sources/HallOfFame.csv&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-5" title="5"><span class="st">  </span><span class="kw">clean_names</span>() <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-6" title="6"><span class="st">  </span><span class="kw">select</span>(player_id, inducted) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-7" title="7"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">hof =</span> <span class="kw">ifelse</span>(inducted<span class="op">==</span><span class="st">&quot;Y&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb87-8" title="8"><span class="st">  </span><span class="kw">filter</span>(hof<span class="op">==</span><span class="dv">1</span>)</a>
<a class="sourceLine" id="cb87-9" title="9"></a>
<a class="sourceLine" id="cb87-10" title="10">hofdata <span class="op">%&gt;%</span><span class="st">  </span><span class="kw">count</span>(inducted)</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##   inducted     n
##   &lt;chr&gt;    &lt;int&gt;
## 1 Y          317</code></pre>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb89-1" title="1">retiredyear =<span class="st"> </span></a>
<a class="sourceLine" id="cb89-2" title="2">data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb89-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(player_id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb89-4" title="4"><span class="st">  </span><span class="kw">summarise</span>(<span class="dt">lastyear =</span> <span class="kw">max</span>(year_id))</a>
<a class="sourceLine" id="cb89-5" title="5">retiredyear</a></code></pre></div>
<pre><code>## # A tibble: 18,915 x 2
##    player_id lastyear
##    &lt;chr&gt;        &lt;dbl&gt;
##  1 aardsda01     2015
##  2 aaronha01     1976
##  3 aaronto01     1971
##  4 aasedo01      1990
##  5 abadan01      2006
##  6 abadfe01      2016
##  7 abadijo01     1875
##  8 abbated01     1910
##  9 abbeybe01     1896
## 10 abbeych01     1897
## # ... with 18,905 more rows</code></pre>
<div class="sourceCode" id="cb91"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb91-1" title="1">hof =</a>
<a class="sourceLine" id="cb91-2" title="2">data <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb91-3" title="3"><span class="st">  </span><span class="kw">group_by</span>(player_id) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb91-4" title="4"><span class="st">  </span><span class="kw">summarise_at</span>(<span class="kw">vars</span>(g<span class="op">:</span>gidp), <span class="kw">list</span>(<span class="op">~</span><span class="kw">sum</span>(.,<span class="dt">na.rm =</span> <span class="ot">TRUE</span>))) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb91-5" title="5"><span class="st">  </span><span class="kw">ungroup</span>() <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb91-6" title="6"><span class="st">  </span><span class="kw">left_join</span>(retiredyear) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb91-7" title="7"><span class="st">  </span><span class="kw">left_join</span>(hofdata) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb91-8" title="8"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">inducted =</span> <span class="kw">if_else</span>(inducted<span class="op">==</span><span class="st">&quot;Y&quot;</span>,<span class="dv">1</span>,<span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb91-9" title="9"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">inducted =</span> <span class="kw">replace_na</span>(inducted, <span class="dv">0</span>)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb91-10" title="10"><span class="st">  </span><span class="kw">filter</span>(g<span class="op">&gt;=</span><span class="dv">1000</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb91-11" title="11"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">inducted =</span> <span class="kw">as.factor</span>(inducted)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb91-12" title="12"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>hof)</a>
<a class="sourceLine" id="cb91-13" title="13"></a>
<a class="sourceLine" id="cb91-14" title="14">hof</a></code></pre></div>
<pre><code>## # A tibble: 1,565 x 20
##    player_id     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so   ibb   hbp    sh    sf  gidp lastyear inducted
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;    &lt;dbl&gt; &lt;fct&gt;   
##  1 aaronha01  3298 12364  2174  3771   624    98   755  2297   240    73  1402  1383   293    32    21   121   328     1976 1       
##  2 abreubo01  2425  8480  1453  2470   574    59   288  1363   400   128  1476  1840   115    33     7    85   165     2014 0       
##  3 adairje01  1165  4019   378  1022   163    19    57   366    29    29   208   499    31    17    41    30   149     1970 0       
##  4 adamsbo03  1281  4019   591  1082   188    49    37   303    67    30   414   447     1    17    78     5    62     1959 0       
##  5 adamssp01  1424  5557   844  1588   249    48     9   394   154    50   453   223     0    28   136     0    14     1934 0       
##  6 adcocjo01  1959  6606   823  1832   295    35   336  1122    20    25   594  1059    55    17    52    35   223     1966 0       
##  7 ageeto01   1129  3912   558   999   170    27   130   433   167    81   342   918    26    34    21    15    99     1973 0       
##  8 ainsmed01  1078  3048   299   707   108    54    22   317    86    16   263   315     0    12    99     0     0     1924 0       
##  9 alfoned01  1506  5385   777  1532   282    18   146   744    53    17   596   617    22    41    31    55   110     2006 0       
## 10 alicelu01  1341  3971   551  1031   189    53    47   422    81    50   500   624    25    48    49    45    74     2002 0       
## # ... with 1,555 more rows</code></pre>
<div id="filter-for-hof-eligable-players" class="section level3 unnumbered">
<h3>Filter for HOF Eligable Players</h3>
<div class="sourceCode" id="cb93"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb93-1" title="1">hof <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb93-2" title="2"><span class="st">  </span><span class="kw">filter</span>(lastyear <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2012</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb93-3" title="3"><span class="st">  </span><span class="kw">count</span>(inducted) </a></code></pre></div>
<pre><code>## # A tibble: 2 x 2
##   inducted     n
##   &lt;fct&gt;    &lt;int&gt;
## 1 0         1229
## 2 1          168</code></pre>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb95-1" title="1">hofmod =</a>
<a class="sourceLine" id="cb95-2" title="2">hof <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb95-3" title="3"><span class="st">  </span><span class="kw">filter</span>(lastyear <span class="op">&lt;=</span><span class="st"> </span><span class="dv">2012</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb95-4" title="4"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>lastyear)</a>
<a class="sourceLine" id="cb95-5" title="5">hofmod</a></code></pre></div>
<pre><code>## # A tibble: 1,397 x 19
##    player_id     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so   ibb   hbp    sh    sf  gidp inducted
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;fct&gt;   
##  1 aaronha01  3298 12364  2174  3771   624    98   755  2297   240    73  1402  1383   293    32    21   121   328 1       
##  2 adairje01  1165  4019   378  1022   163    19    57   366    29    29   208   499    31    17    41    30   149 0       
##  3 adamsbo03  1281  4019   591  1082   188    49    37   303    67    30   414   447     1    17    78     5    62 0       
##  4 adamssp01  1424  5557   844  1588   249    48     9   394   154    50   453   223     0    28   136     0    14 0       
##  5 adcocjo01  1959  6606   823  1832   295    35   336  1122    20    25   594  1059    55    17    52    35   223 0       
##  6 ageeto01   1129  3912   558   999   170    27   130   433   167    81   342   918    26    34    21    15    99 0       
##  7 ainsmed01  1078  3048   299   707   108    54    22   317    86    16   263   315     0    12    99     0     0 0       
##  8 alfoned01  1506  5385   777  1532   282    18   146   744    53    17   596   617    22    41    31    55   110 0       
##  9 alicelu01  1341  3971   551  1031   189    53    47   422    81    50   500   624    25    48    49    45    74 0       
## 10 allenbe01  1139  3404   357   815   140    21    73   351    13    16   370   424    52     8    24    17    60 0       
## # ... with 1,387 more rows</code></pre>
<div class="sourceCode" id="cb97"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb97-1" title="1">hoftest =<span class="st"> </span></a>
<a class="sourceLine" id="cb97-2" title="2">hof <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb97-3" title="3"><span class="st">  </span><span class="kw">filter</span>(lastyear <span class="op">&gt;</span><span class="st"> </span><span class="dv">2012</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb97-4" title="4"><span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>lastyear,<span class="op">-</span>inducted)</a>
<a class="sourceLine" id="cb97-5" title="5">hoftest</a></code></pre></div>
<pre><code>## # A tibble: 168 x 18
##    player_id     g    ab     r     h   x2b   x3b    hr   rbi    sb    cs    bb    so   ibb   hbp    sh    sf  gidp
##    &lt;chr&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
##  1 abreubo01  2425  8480  1453  2470   574    59   288  1363   400   128  1476  1840   115    33     7    85   165
##  2 andruel01  1221  4625   648  1266   207    37    35   436   241    83   408   684     4    34    99    36   114
##  3 aybarer01  1346  4842   606  1324   241    45    51   451   144    58   257   613    16    48    72    37   102
##  4 barmecl01  1186  3805   434   932   208    17    89   415    43    30   216   734    32    60    60    26    54
##  5 bautijo02  1519  5139   878  1311   267    17   308   862    60    26   881  1113    53    66    23    50   152
##  6 bayja01    1278  4505   737  1200   240    30   222   754    95    17   636  1216    38    56     7    54    84
##  7 beltrad01  2720 10295  1428  2942   591    36   445  1571   119    42   775  1584   108    87    14    89   259
##  8 beltrca01  2457  9301  1522  2617   536    78   421  1536   312    49  1051  1693   101    48    18   104   194
##  9 berkmla01  1879  6491  1146  1905   422    30   366  1234    86    48  1201  1300   160    66     1    54   147
## 10 betanyu01  1156  4052   437  1057   218    29    80   457    30    30   143   435    10    10    34    39   110
## # ... with 158 more rows</code></pre>
</div>
</div>
<div id="data-exploration" class="section level2">
<h2><span class="header-section-number">5.3</span> Data Exploration</h2>
<div class="sourceCode" id="cb99"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb99-1" title="1">hofmod <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb99-2" title="2"><span class="st">  </span><span class="kw">select</span>(g<span class="op">:</span>inducted) <span class="op">%&gt;%</span><span class="st">  </span></a>
<a class="sourceLine" id="cb99-3" title="3"><span class="st">  </span><span class="kw">pivot_longer</span>(<span class="dt">cols =</span> g<span class="op">:</span>gidp) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb99-4" title="4"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x=</span>value,<span class="dt">y=</span><span class="kw">as.factor</span>(inducted),<span class="dt">color =</span> name)) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-5" title="5"><span class="st">  </span><span class="kw">geom_point</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb99-6" title="6"><span class="st">  </span><span class="kw">theme</span>(<span class="dt">legend.position =</span> <span class="st">&quot;none&quot;</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb99-7" title="7"><span class="st">  </span><span class="kw">facet_wrap</span>(<span class="op">~</span>name, <span class="dt">scales =</span> <span class="st">&quot;free&quot;</span>)</a></code></pre></div>
<p><img src="Intermediate_R_files/figure-html/unnamed-chunk-56-1.png" width="672" /></p>
</div>
<div id="split-data-testtrain" class="section level2">
<h2><span class="header-section-number">5.4</span> Split Data test/train</h2>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb100-1" title="1"><span class="kw">set.seed</span>(<span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(<span class="st">&quot;beatnavy&quot;</span>)))</a>
<a class="sourceLine" id="cb100-2" title="2">hof_initial_split =<span class="st"> </span><span class="kw">initial_split</span>(hofmod, <span class="dt">prop =</span> <span class="fl">0.80</span>)</a>
<a class="sourceLine" id="cb100-3" title="3">hof_initial_split</a></code></pre></div>
<pre><code>## &lt;1118/279/1397&gt;</code></pre>
</div>
<div id="preprocess-data" class="section level2">
<h2><span class="header-section-number">5.5</span> Preprocess Data</h2>
<div class="sourceCode" id="cb102"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb102-1" title="1">preprocessing_recipe =</a>
<a class="sourceLine" id="cb102-2" title="2"><span class="st">  </span><span class="kw">recipe</span>(inducted <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> <span class="kw">training</span>(hof_initial_split)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb102-3" title="3"><span class="st">  </span><span class="kw">step_knnimpute</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb102-4" title="4"><span class="st">  </span><span class="kw">step_center</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb102-5" title="5"><span class="st">  </span><span class="kw">step_scale</span>(<span class="kw">all_numeric</span>()) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb102-6" title="6"><span class="st">  </span><span class="kw">step_rm</span>(player_id) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb102-7" title="7"><span class="st">  </span><span class="kw">prep</span>()</a>
<a class="sourceLine" id="cb102-8" title="8">preprocessing_recipe</a></code></pre></div>
<pre><code>## Data Recipe
## 
## Inputs:
## 
##       role #variables
##    outcome          1
##  predictor         18
## 
## Training data contained 1118 data points and no missing data.
## 
## Operations:
## 
## K-nearest neighbor imputation for player_id, ab, r, h, x2b, x3b, hr, rbi, sb, cs, bb, so, ibb, hbp, sh, sf, gidp, g [trained]
## Centering for g, ab, r, h, x2b, x3b, hr, rbi, sb, cs, bb, so, ibb, hbp, sh, sf, gidp [trained]
## Scaling for g, ab, r, h, x2b, x3b, hr, rbi, sb, cs, bb, so, ibb, hbp, sh, sf, gidp [trained]
## Variables removed player_id [trained]</code></pre>
</div>
<div id="apply-preprocessing" class="section level2">
<h2><span class="header-section-number">5.6</span> Apply Preprocessing</h2>
<div class="sourceCode" id="cb104"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb104-1" title="1">hof_training_preprocessed_tbl =<span class="st"> </span></a>
<a class="sourceLine" id="cb104-2" title="2"><span class="st">  </span>preprocessing_recipe <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb104-3" title="3"><span class="st">  </span><span class="kw">bake</span>(<span class="kw">training</span>(hof_initial_split))</a>
<a class="sourceLine" id="cb104-4" title="4"></a>
<a class="sourceLine" id="cb104-5" title="5">hof_training_preprocessed_tbl</a></code></pre></div>
<pre><code>## # A tibble: 1,118 x 18
##         g      ab       r       h     x2b       x3b      hr    rbi     sb     cs     bb       so     ibb    hbp     sh      sf   gidp inducted
##     &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;    &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;fct&gt;   
##  1  3.96   3.72    3.93    3.84    3.27    1.08      5.51    4.55   0.786  0.783  2.89   1.93     6.08   -0.166 -0.660  3.26    3.47  1       
##  2 -0.873 -0.702  -1.08   -0.770  -0.790  -0.861    -0.556  -0.939 -0.701 -0.323 -1.11  -0.290   -0.0466 -0.621 -0.365  0.0599  0.909 0       
##  3 -0.610 -0.702  -0.489  -0.669  -0.570  -0.122    -0.730  -1.12  -0.433 -0.298 -0.421 -0.421   -0.748  -0.621  0.182 -0.818  -0.336 0       
##  4 -0.286  0.113   0.217   0.179  -0.0318 -0.147    -0.974  -0.859  0.180  0.205 -0.290 -0.984   -0.772  -0.288  1.04  -0.994  -1.02  0       
##  5  0.925  0.670   0.158   0.589   0.374  -0.467     1.87    1.21  -0.764 -0.423  0.182  1.12     0.515  -0.621 -0.202  0.235   1.97  0       
##  6 -0.954 -0.759  -0.582  -0.809  -0.728  -0.664     0.0781 -0.748  0.272  0.984 -0.662  0.764   -0.164  -0.106 -0.660 -0.467   0.194 0       
##  7 -1.07  -1.22   -1.30   -1.30   -1.27    0.000594 -0.861  -1.08  -0.299 -0.649 -0.927 -0.753   -0.772  -0.772  0.492 -0.994  -1.22  0       
##  8 -0.101  0.0222  0.0300  0.0853  0.259  -0.885     0.217   0.136 -0.532 -0.624  0.189  0.00688 -0.257   0.106 -0.513  0.938   0.351 0       
##  9 -0.474 -0.728  -0.601  -0.755  -0.561  -0.0240   -0.643  -0.780 -0.334  0.205 -0.133  0.0245  -0.187   0.319 -0.247  0.587  -0.164 0       
## 10 -0.932 -1.03   -1.14   -1.12   -0.993  -0.812    -0.417  -0.981 -0.813 -0.649 -0.568 -0.478    0.445  -0.894 -0.616 -0.397  -0.364 0       
## # ... with 1,108 more rows</code></pre>
</div>
<div id="prepare-cross-validation" class="section level2">
<h2><span class="header-section-number">5.7</span> Prepare Cross Validation</h2>
<div class="sourceCode" id="cb106"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb106-1" title="1"><span class="kw">set.seed</span>(<span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(<span class="st">&quot;beatnavy&quot;</span>)))</a>
<a class="sourceLine" id="cb106-2" title="2">hof_cv_folds =</a>
<a class="sourceLine" id="cb106-3" title="3"><span class="st">  </span><span class="kw">training</span>(hof_initial_split) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb106-4" title="4"><span class="st">    </span><span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb106-5" title="5"><span class="st">    </span><span class="kw">vfold_cv</span>(<span class="dt">v =</span> <span class="dv">5</span>)</a>
<a class="sourceLine" id="cb106-6" title="6">hof_cv_folds</a></code></pre></div>
<pre><code>## #  5-fold cross-validation 
## # A tibble: 5 x 2
##   splits            id   
##   &lt;named list&gt;      &lt;chr&gt;
## 1 &lt;split [894/224]&gt; Fold1
## 2 &lt;split [894/224]&gt; Fold2
## 3 &lt;split [894/224]&gt; Fold3
## 4 &lt;split [895/223]&gt; Fold4
## 5 &lt;split [895/223]&gt; Fold5</code></pre>
</div>
<div id="specify-models" class="section level2">
<h2><span class="header-section-number">5.8</span> Specify Models</h2>
<div id="glm-model" class="section level3 unnumbered">
<h3>GLM Model</h3>
<div class="sourceCode" id="cb108"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb108-1" title="1">glmnet_model =</a>
<a class="sourceLine" id="cb108-2" title="2"><span class="st">  </span><span class="kw">logistic_reg</span>(<span class="dt">mode =</span> <span class="st">&quot;classification&quot;</span>,</a>
<a class="sourceLine" id="cb108-3" title="3">    <span class="dt">penalty =</span> <span class="kw">tune</span>(),</a>
<a class="sourceLine" id="cb108-4" title="4">    <span class="dt">mixture =</span> <span class="kw">tune</span>()) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb108-5" title="5"><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;glmnet&quot;</span>)</a>
<a class="sourceLine" id="cb108-6" title="6"></a>
<a class="sourceLine" id="cb108-7" title="7">glmnet_model</a></code></pre></div>
<pre><code>## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = tune()
##   mixture = tune()
## 
## Computational engine: glmnet</code></pre>
</div>
<div id="random-forest-model" class="section level3 unnumbered">
<h3>Random Forest Model</h3>
<div class="sourceCode" id="cb110"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb110-1" title="1">forest_model =</a>
<a class="sourceLine" id="cb110-2" title="2"><span class="st">  </span><span class="kw">rand_forest</span>(</a>
<a class="sourceLine" id="cb110-3" title="3">    <span class="dt">mode =</span> <span class="st">&quot;classification&quot;</span>,</a>
<a class="sourceLine" id="cb110-4" title="4">    <span class="dt">mtry =</span> <span class="kw">tune</span>(),</a>
<a class="sourceLine" id="cb110-5" title="5">    <span class="dt">trees =</span> <span class="kw">tune</span>(),</a>
<a class="sourceLine" id="cb110-6" title="6">    <span class="dt">min_n =</span> <span class="kw">tune</span>()</a>
<a class="sourceLine" id="cb110-7" title="7">  ) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb110-8" title="8"><span class="st">  </span><span class="kw">set_engine</span>(<span class="st">&quot;randomForest&quot;</span>, <span class="dt">objective =</span> <span class="st">&quot;reg:squarederror&quot;</span>)</a>
<a class="sourceLine" id="cb110-9" title="9"></a>
<a class="sourceLine" id="cb110-10" title="10">forest_model</a></code></pre></div>
<pre><code>## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = tune()
##   trees = tune()
##   min_n = tune()
## 
## Engine-Specific Arguments:
##   objective = reg:squarederror
## 
## Computational engine: randomForest</code></pre>
</div>
</div>
<div id="create-grid-of-parameters-to-validate-over" class="section level2">
<h2><span class="header-section-number">5.9</span> Create Grid of Parameters to Validate Over</h2>
<div id="glm-model-1" class="section level3 unnumbered">
<h3>GLM Model</h3>
<div class="sourceCode" id="cb112"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb112-1" title="1">glmnet_params =<span class="st"> </span><span class="kw">parameters</span>(<span class="kw">penalty</span>(), <span class="kw">mixture</span>())</a>
<a class="sourceLine" id="cb112-2" title="2">glmnet_params</a></code></pre></div>
<pre><code>## Collection of 2 parameters for tuning
## 
##       id parameter type object class
##  penalty        penalty    nparam[+]
##  mixture        mixture    nparam[+]</code></pre>
<div class="sourceCode" id="cb114"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb114-1" title="1"><span class="kw">set.seed</span>(<span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(<span class="st">&quot;beatnavy&quot;</span>)))</a>
<a class="sourceLine" id="cb114-2" title="2">glmnet_grid =<span class="st"> </span><span class="kw">grid_max_entropy</span>(glmnet_params, <span class="dt">size =</span> <span class="dv">20</span>)</a>
<a class="sourceLine" id="cb114-3" title="3">glmnet_grid</a></code></pre></div>
<pre><code>## # A tibble: 20 x 2
##     penalty mixture
##       &lt;dbl&gt;   &lt;dbl&gt;
##  1 1.77e- 9  0.508 
##  2 2.24e- 2  0.0442
##  3 4.54e-10  0.852 
##  4 1.93e- 8  0.206 
##  5 5.17e- 2  0.988 
##  6 4.62e- 9  0.0242
##  7 1.94e- 6  0.338 
##  8 8.83e- 1  0.608 
##  9 8.52e- 3  0.597 
## 10 1.23e-10  0.105 
## 11 2.40e-10  0.313 
## 12 5.91e- 8  0.694 
## 13 8.03e- 8  0.936 
## 14 1.32e- 2  0.350 
## 15 8.91e- 6  0.515 
## 16 1.66e- 4  0.915 
## 17 1.44e- 4  0.702 
## 18 1.38e- 6  0.0159
## 19 1.35e-10  0.643 
## 20 7.04e- 4  0.196</code></pre>
<div class="sourceCode" id="cb116"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb116-1" title="1">glmnet_grid <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb116-2" title="2"><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(penalty, mixture)) <span class="op">+</span></a>
<a class="sourceLine" id="cb116-3" title="3"><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">size =</span> <span class="dv">3</span>) <span class="op">+</span></a>
<a class="sourceLine" id="cb116-4" title="4"><span class="st">  </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></a>
<a class="sourceLine" id="cb116-5" title="5"><span class="st">  </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Max Entropy Grid&quot;</span>, <span class="dt">x =</span> <span class="st">&quot;Penalty (log scale)&quot;</span>, <span class="dt">y =</span> <span class="st">&quot;Mixture&quot;</span>)</a></code></pre></div>
<p><img src="Intermediate_R_files/figure-html/unnamed-chunk-63-1.png" width="672" /></p>
</div>
<div id="random-forest-model-1" class="section level3 unnumbered">
<h3>Random Forest Model</h3>
<div class="sourceCode" id="cb117"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb117-1" title="1">forest_params =<span class="st"> </span><span class="kw">parameters</span>(<span class="kw">mtry</span>(<span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">6</span>)), <span class="kw">trees</span>(), <span class="kw">min_n</span>())</a>
<a class="sourceLine" id="cb117-2" title="2">forest_params</a></code></pre></div>
<pre><code>## Collection of 3 parameters for tuning
## 
##     id parameter type object class
##   mtry           mtry    nparam[+]
##  trees          trees    nparam[+]
##  min_n          min_n    nparam[+]</code></pre>
<div class="sourceCode" id="cb119"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb119-1" title="1"><span class="kw">set.seed</span>(<span class="kw">as.numeric</span>(<span class="kw">as.factor</span>(<span class="st">&quot;beatnavy&quot;</span>)))</a>
<a class="sourceLine" id="cb119-2" title="2">forest_grid =<span class="st"> </span><span class="kw">grid_max_entropy</span>(forest_params, <span class="dt">size =</span> <span class="dv">30</span>)</a>
<a class="sourceLine" id="cb119-3" title="3">forest_grid</a></code></pre></div>
<pre><code>## # A tibble: 30 x 3
##     mtry trees min_n
##    &lt;int&gt; &lt;int&gt; &lt;int&gt;
##  1     2  1264     5
##  2     4  1113    28
##  3     5   622    11
##  4     2    28     6
##  5     3    24    19
##  6     3  1479    36
##  7     4  1404    13
##  8     5    33    40
##  9     6   115    15
## 10     6   686     3
## # ... with 20 more rows</code></pre>
</div>
</div>
<div id="execute-cross-validation" class="section level2">
<h2><span class="header-section-number">5.10</span> Execute Cross Validation</h2>
<div id="parallel-processing" class="section level3">
<h3><span class="header-section-number">5.10.1</span> Parallel Processing</h3>
<div class="sourceCode" id="cb121"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb121-1" title="1">all_cores &lt;-<span class="st"> </span>parallel<span class="op">::</span><span class="kw">detectCores</span>(<span class="dt">logical =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb121-2" title="2"></a>
<a class="sourceLine" id="cb121-3" title="3"><span class="kw">library</span>(doFuture)</a>
<a class="sourceLine" id="cb121-4" title="4"><span class="kw">registerDoFuture</span>()</a>
<a class="sourceLine" id="cb121-5" title="5">cl &lt;-<span class="st"> </span><span class="kw">makeCluster</span>(all_cores)</a>
<a class="sourceLine" id="cb121-6" title="6"><span class="kw">plan</span>(cluster, <span class="dt">workers =</span> cl)</a></code></pre></div>
</div>
<div id="glm-model-2" class="section level3 unnumbered">
<h3>GLM Model</h3>
<div class="sourceCode" id="cb122"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb122-1" title="1"><span class="kw">library</span>(tune)</a>
<a class="sourceLine" id="cb122-2" title="2"></a>
<a class="sourceLine" id="cb122-3" title="3">glmnet_stage_<span class="dv">1</span>_cv_results_tbl =<span class="st"> </span><span class="kw">tune_grid</span>(</a>
<a class="sourceLine" id="cb122-4" title="4">    <span class="dt">formula   =</span> inducted <span class="op">~</span><span class="st"> </span>.,</a>
<a class="sourceLine" id="cb122-5" title="5">    <span class="dt">model     =</span> glmnet_model,</a>
<a class="sourceLine" id="cb122-6" title="6">    <span class="dt">resamples =</span> hof_cv_folds,</a>
<a class="sourceLine" id="cb122-7" title="7">    <span class="dt">grid      =</span> glmnet_grid,</a>
<a class="sourceLine" id="cb122-8" title="8">    <span class="dt">metrics   =</span> <span class="kw">metric_set</span>(accuracy, kap, roc_auc),</a>
<a class="sourceLine" id="cb122-9" title="9">    <span class="dt">control   =</span> <span class="kw">control_grid</span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb122-10" title="10">)</a>
<a class="sourceLine" id="cb122-11" title="11"></a>
<a class="sourceLine" id="cb122-12" title="12">glmnet_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 7
##     penalty mixture .metric  .estimator  mean     n std_err
##       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1 8.52e- 3  0.597  accuracy binary     0.920     5 0.0117 
##  2 2.24e- 2  0.0442 accuracy binary     0.918     5 0.0113 
##  3 1.32e- 2  0.350  accuracy binary     0.917     5 0.0109 
##  4 1.38e- 6  0.0159 accuracy binary     0.914     5 0.0115 
##  5 4.62e- 9  0.0242 accuracy binary     0.913     5 0.0121 
##  6 5.17e- 2  0.988  accuracy binary     0.913     5 0.00871
##  7 1.23e-10  0.105  accuracy binary     0.913     5 0.0105 
##  8 1.35e-10  0.643  accuracy binary     0.913     5 0.00990
##  9 4.54e-10  0.852  accuracy binary     0.913     5 0.00990
## 10 1.77e- 9  0.508  accuracy binary     0.913     5 0.0107</code></pre>
<div class="sourceCode" id="cb124"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb124-1" title="1">glmnet_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;kap&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 7
##     penalty mixture .metric .estimator  mean     n std_err
##       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1 8.52e- 3  0.597  kap     binary     0.518     5  0.0627
##  2 1.23e-10  0.105  kap     binary     0.507     5  0.0454
##  3 1.35e-10  0.643  kap     binary     0.506     5  0.0423
##  4 4.54e-10  0.852  kap     binary     0.506     5  0.0423
##  5 5.91e- 8  0.694  kap     binary     0.506     5  0.0423
##  6 8.03e- 8  0.936  kap     binary     0.506     5  0.0423
##  7 1.77e- 9  0.508  kap     binary     0.504     5  0.0442
##  8 8.91e- 6  0.515  kap     binary     0.504     5  0.0442
##  9 1.38e- 6  0.0159 kap     binary     0.502     5  0.0530
## 10 2.40e-10  0.313  kap     binary     0.500     5  0.0432</code></pre>
<div class="sourceCode" id="cb126"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb126-1" title="1">glmnet_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;roc_auc&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 7
##     penalty mixture .metric .estimator  mean     n std_err
##       &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1 7.04e- 4  0.196  roc_auc binary     0.922     5  0.0116
##  2 1.38e- 6  0.0159 roc_auc binary     0.921     5  0.0118
##  3 4.62e- 9  0.0242 roc_auc binary     0.921     5  0.0117
##  4 8.52e- 3  0.597  roc_auc binary     0.921     5  0.0128
##  5 1.23e-10  0.105  roc_auc binary     0.921     5  0.0118
##  6 1.44e- 4  0.702  roc_auc binary     0.920     5  0.0119
##  7 1.93e- 8  0.206  roc_auc binary     0.920     5  0.0119
##  8 1.32e- 2  0.350  roc_auc binary     0.920     5  0.0128
##  9 2.40e-10  0.313  roc_auc binary     0.920     5  0.0119
## 10 1.66e- 4  0.915  roc_auc binary     0.919     5  0.0120</code></pre>
</div>
<div id="random-forest-model-2" class="section level3 unnumbered">
<h3>Random Forest Model</h3>
<div class="sourceCode" id="cb128"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb128-1" title="1">forest_stage_<span class="dv">1</span>_cv_results_tbl =<span class="st"> </span><span class="kw">tune_grid</span>(</a>
<a class="sourceLine" id="cb128-2" title="2">    <span class="dt">formula   =</span> inducted <span class="op">~</span><span class="st"> </span>.,</a>
<a class="sourceLine" id="cb128-3" title="3">    <span class="dt">model     =</span> forest_model,</a>
<a class="sourceLine" id="cb128-4" title="4">    <span class="dt">resamples =</span> hof_cv_folds,</a>
<a class="sourceLine" id="cb128-5" title="5">    <span class="dt">grid      =</span> forest_grid,</a>
<a class="sourceLine" id="cb128-6" title="6">    <span class="dt">metrics   =</span> <span class="kw">metric_set</span>(accuracy, kap, roc_auc),</a>
<a class="sourceLine" id="cb128-7" title="7">    <span class="dt">control   =</span> <span class="kw">control_grid</span>(<span class="dt">verbose =</span> <span class="ot">TRUE</span>)</a>
<a class="sourceLine" id="cb128-8" title="8">)</a>
<a class="sourceLine" id="cb128-9" title="9"></a>
<a class="sourceLine" id="cb128-10" title="10">forest_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;accuracy&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 8
##     mtry trees min_n .metric  .estimator  mean     n std_err
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;    &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1     6   115    15 accuracy binary     0.924     5 0.00965
##  2     5   291    22 accuracy binary     0.921     5 0.00906
##  3     4   725    39 accuracy binary     0.920     5 0.0113 
##  4     3   377     3 accuracy binary     0.920     5 0.00947
##  5     4  1404    13 accuracy binary     0.920     5 0.00947
##  6     6   686     3 accuracy binary     0.920     5 0.00823
##  7     3  1963    26 accuracy binary     0.920     5 0.00812
##  8     3   379    31 accuracy binary     0.920     5 0.0107 
##  9     3  1479    36 accuracy binary     0.920     5 0.0116 
## 10     5  1130    17 accuracy binary     0.920     5 0.0104</code></pre>
<div class="sourceCode" id="cb130"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb130-1" title="1">forest_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;kap&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 8
##     mtry trees min_n .metric .estimator  mean     n std_err
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1     6   115    15 kap     binary     0.553     5  0.0596
##  2     3   377     3 kap     binary     0.533     5  0.0600
##  3     5   291    22 kap     binary     0.532     5  0.0670
##  4     3  1963    26 kap     binary     0.531     5  0.0658
##  5     6   686     3 kap     binary     0.530     5  0.0572
##  6     4  1404    13 kap     binary     0.530     5  0.0591
##  7     4   725    39 kap     binary     0.530     5  0.0796
##  8     3   963    39 kap     binary     0.527     5  0.0789
##  9     3  1479    36 kap     binary     0.525     5  0.0810
## 10     3   379    31 kap     binary     0.523     5  0.0756</code></pre>
<div class="sourceCode" id="cb132"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb132-1" title="1">forest_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">show_best</span>(<span class="st">&quot;roc_auc&quot;</span>, <span class="dt">n =</span> <span class="dv">10</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</a></code></pre></div>
<pre><code>## # A tibble: 10 x 8
##     mtry trees min_n .metric .estimator  mean     n std_err
##    &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;chr&gt;   &lt;chr&gt;      &lt;dbl&gt; &lt;int&gt;   &lt;dbl&gt;
##  1     4  1113    28 roc_auc binary     0.925     5  0.0137
##  2     3  1479    36 roc_auc binary     0.924     5  0.0136
##  3     2  1986    16 roc_auc binary     0.924     5  0.0125
##  4     3  1963    26 roc_auc binary     0.923     5  0.0131
##  5     2  1264     5 roc_auc binary     0.923     5  0.0131
##  6     4  1128     2 roc_auc binary     0.923     5  0.0139
##  7     4  1404    13 roc_auc binary     0.922     5  0.0137
##  8     3   691    22 roc_auc binary     0.922     5  0.0142
##  9     3   963    39 roc_auc binary     0.922     5  0.0147
## 10     2   605    13 roc_auc binary     0.921     5  0.0131</code></pre>
</div>
</div>
<div id="select-best-parameters" class="section level2">
<h2><span class="header-section-number">5.11</span> Select Best Parameters</h2>
<div class="sourceCode" id="cb134"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb134-1" title="1">params_glmnet_best =<span class="st"> </span>glmnet_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb134-2" title="2"><span class="st">    </span><span class="kw">select_best</span>(<span class="st">&quot;roc_auc&quot;</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb134-3" title="3">params_glmnet_best</a></code></pre></div>
<pre><code>## # A tibble: 1 x 2
##    penalty mixture
##      &lt;dbl&gt;   &lt;dbl&gt;
## 1 0.000704   0.196</code></pre>
<div class="sourceCode" id="cb136"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb136-1" title="1">params_forest_best =<span class="st"> </span>forest_stage_<span class="dv">1</span>_cv_results_tbl <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb136-2" title="2"><span class="st">    </span><span class="kw">select_best</span>(<span class="st">&quot;roc_auc&quot;</span>, <span class="dt">maximize =</span> <span class="ot">FALSE</span>)</a>
<a class="sourceLine" id="cb136-3" title="3">params_forest_best</a></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##    mtry trees min_n
##   &lt;int&gt; &lt;int&gt; &lt;int&gt;
## 1     4  1113    28</code></pre>
</div>
<div id="save-best-paramenters" class="section level2">
<h2><span class="header-section-number">5.12</span> Save Best Paramenters</h2>
<div class="sourceCode" id="cb138"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb138-1" title="1">glmnet_stage_<span class="dv">2</span>_model =<span class="st"> </span>glmnet_model <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb138-2" title="2"><span class="st">    </span><span class="kw">finalize_model</span>(<span class="dt">parameters =</span> params_glmnet_best)</a>
<a class="sourceLine" id="cb138-3" title="3"></a>
<a class="sourceLine" id="cb138-4" title="4">glmnet_stage_<span class="dv">2</span>_model</a></code></pre></div>
<pre><code>## Logistic Regression Model Specification (classification)
## 
## Main Arguments:
##   penalty = 0.000703590468650661
##   mixture = 0.195607561385259
## 
## Computational engine: glmnet</code></pre>
<div class="sourceCode" id="cb140"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb140-1" title="1">forest_stage_<span class="dv">2</span>_model =<span class="st"> </span>forest_model <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb140-2" title="2"><span class="st">    </span><span class="kw">finalize_model</span>(params_forest_best)</a>
<a class="sourceLine" id="cb140-3" title="3"></a>
<a class="sourceLine" id="cb140-4" title="4">forest_stage_<span class="dv">2</span>_model</a></code></pre></div>
<pre><code>## Random Forest Model Specification (classification)
## 
## Main Arguments:
##   mtry = 4
##   trees = 1113
##   min_n = 28
## 
## Engine-Specific Arguments:
##   objective = reg:squarederror
## 
## Computational engine: randomForest</code></pre>
</div>
<div id="compare-models" class="section level2">
<h2><span class="header-section-number">5.13</span> Compare Models</h2>
<div class="sourceCode" id="cb142"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb142-1" title="1">train_processed =<span class="st"> </span></a>
<a class="sourceLine" id="cb142-2" title="2"><span class="st">  </span><span class="kw">training</span>(hof_initial_split) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb142-3" title="3"><span class="st">  </span><span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> .)</a>
<a class="sourceLine" id="cb142-4" title="4"></a>
<a class="sourceLine" id="cb142-5" title="5">test_processed  =<span class="st"> </span></a>
<a class="sourceLine" id="cb142-6" title="6"><span class="st">  </span><span class="kw">testing</span>(hof_initial_split) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb142-7" title="7"><span class="st">  </span><span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> .)</a>
<a class="sourceLine" id="cb142-8" title="8">    </a>
<a class="sourceLine" id="cb142-9" title="9">target_expr =<span class="st"> </span></a>
<a class="sourceLine" id="cb142-10" title="10"><span class="st">  </span>preprocessing_recipe <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb142-11" title="11"><span class="st">    </span><span class="kw">pluck</span>(<span class="st">&quot;last_term_info&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-12" title="12"><span class="st">    </span><span class="kw">filter</span>(role <span class="op">==</span><span class="st"> &quot;outcome&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-13" title="13"><span class="st">    </span><span class="kw">pull</span>(variable) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-14" title="14"><span class="st">    </span><span class="kw">sym</span>()</a>
<a class="sourceLine" id="cb142-15" title="15"></a>
<a class="sourceLine" id="cb142-16" title="16">glmnet_stage_<span class="dv">2</span>_metrics =<span class="st">    </span></a>
<a class="sourceLine" id="cb142-17" title="17"><span class="st">  </span>glmnet_stage_<span class="dv">2</span>_model <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-18" title="18"><span class="st">  </span><span class="kw">fit</span>(<span class="dt">formula =</span> inducted <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> train_processed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-19" title="19"><span class="st">  </span><span class="kw">predict</span>(<span class="dt">new_data =</span> test_processed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-20" title="20"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">testing</span>(hof_initial_split)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-21" title="21"><span class="st">  </span><span class="kw">metrics</span>(<span class="op">!!</span><span class="st"> </span>target_expr, .pred_class)</a>
<a class="sourceLine" id="cb142-22" title="22"></a>
<a class="sourceLine" id="cb142-23" title="23">forest_stage_<span class="dv">2</span>_metrics =<span class="st">    </span></a>
<a class="sourceLine" id="cb142-24" title="24"><span class="st">  </span>forest_stage_<span class="dv">2</span>_model <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-25" title="25"><span class="st">  </span><span class="kw">fit</span>(<span class="dt">formula =</span> inducted <span class="op">~</span><span class="st"> </span>., <span class="dt">data =</span> train_processed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-26" title="26"><span class="st">  </span><span class="kw">predict</span>(<span class="dt">new_data =</span> test_processed) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-27" title="27"><span class="st">  </span><span class="kw">bind_cols</span>(<span class="kw">testing</span>(hof_initial_split)) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb142-28" title="28"><span class="st">  </span><span class="kw">metrics</span>(<span class="op">!!</span><span class="st"> </span>target_expr, .pred_class)</a>
<a class="sourceLine" id="cb142-29" title="29"></a>
<a class="sourceLine" id="cb142-30" title="30">glmnet_stage_<span class="dv">2</span>_metrics <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb142-31" title="31"><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mod =</span> <span class="st">&quot;glmnet&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb142-32" title="32"><span class="st">  </span><span class="kw">bind_rows</span>(</a>
<a class="sourceLine" id="cb142-33" title="33">    forest_stage_<span class="dv">2</span>_metrics <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb142-34" title="34"><span class="st">      </span><span class="kw">mutate</span>(<span class="dt">mod =</span> <span class="st">&quot;forest&quot;</span>)</a>
<a class="sourceLine" id="cb142-35" title="35">    ) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb142-36" title="36"><span class="st">  </span><span class="kw">arrange</span>(.metric,<span class="op">-</span>.estimate)</a></code></pre></div>
<pre><code>## # A tibble: 4 x 4
##   .metric  .estimator .estimate mod   
##   &lt;chr&gt;    &lt;chr&gt;          &lt;dbl&gt; &lt;chr&gt; 
## 1 accuracy binary         0.907 glmnet
## 2 accuracy binary         0.900 forest
## 3 kap      binary         0.521 glmnet
## 4 kap      binary         0.497 forest</code></pre>
<p>Looks like the Random Forest is the better model.</p>
</div>
<div id="run-best-model-on-all-data" class="section level2">
<h2><span class="header-section-number">5.14</span> Run Best Model on All Data</h2>
<div class="sourceCode" id="cb144"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb144-1" title="1">model_final =<span class="st"> </span>forest_stage_<span class="dv">2</span>_model <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb144-2" title="2"><span class="st">    </span><span class="kw">fit</span>(inducted <span class="op">~</span><span class="st"> </span>. , <span class="dt">data =</span> <span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> hofmod))</a></code></pre></div>
</div>
<div id="run-model-on-new-data" class="section level2">
<h2><span class="header-section-number">5.15</span> Run Model on New Data</h2>
<div class="sourceCode" id="cb145"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb145-1" title="1">hoftest <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-2" title="2"><span class="st">  </span><span class="kw">bake</span>(preprocessing_recipe, <span class="dt">new_data =</span> .) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb145-3" title="3"><span class="st">  </span><span class="kw">predict</span>(model_final, <span class="dt">new_data =</span> .) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb145-4" title="4"><span class="st">  </span><span class="kw">bind_cols</span>(hoftest <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(player_id)) <span class="op">%&gt;%</span><span class="st"> </span></a>
<a class="sourceLine" id="cb145-5" title="5"><span class="st">  </span><span class="kw">arrange</span>(<span class="kw">desc</span>(.pred_class))</a></code></pre></div>
<pre><code>## # A tibble: 168 x 2
##    .pred_class player_id
##    &lt;fct&gt;       &lt;chr&gt;    
##  1 1           beltrad01
##  2 1           beltrca01
##  3 1           jeterde01
##  4 1           pujolal01
##  5 1           rodrial01
##  6 1           rolliji01
##  7 1           suzukic01
##  8 0           abreubo01
##  9 0           andruel01
## 10 0           aybarer01
## # ... with 158 more rows</code></pre>
</div>
<div id="variable-importance" class="section level2">
<h2><span class="header-section-number">5.16</span> Variable Importance</h2>
<div class="sourceCode" id="cb147"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb147-1" title="1"><span class="kw">vip</span>(model_final) <span class="op">+</span></a>
<a class="sourceLine" id="cb147-2" title="2"><span class="st">    </span><span class="kw">labs</span>(<span class="dt">title =</span> <span class="st">&quot;Random Forest Model Importance - HOF Prediction&quot;</span>) </a></code></pre></div>
<p><img src="Intermediate_R_files/figure-html/unnamed-chunk-74-1.png" width="672" /></p>
<p><a href="https://www.r-bloggers.com/product-price-prediction-a-tidy-hyperparameter-tuning-and-cross-validation-tutorial/">Many Thanks</a></p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="4-functional-programming.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="6-text-analysis.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": null,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "none"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
